<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Account Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            dark: { 100: '#1a1a2e', 200: '#16213e', 300: '#0f3460', 400: '#0d1b3e' },
            accent: { DEFAULT: '#e94560', light: '#ff6b81' }
          }
        }
      }
    }
  </script>
  <style>
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #16213e; }
    ::-webkit-scrollbar-thumb { background: #0f3460; border-radius: 3px; }
  </style>
</head>
<body class="bg-dark-100 text-gray-200 h-screen overflow-y-auto font-sans">

  <div class="max-w-[800px] mx-auto p-6">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold text-accent">ðŸ“‹ Group Accounts</h1>
      <button onclick="showCreateGroup()" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg text-sm font-bold transition">+ Create Group</button>
    </div>

    <!-- Group List -->
    <div id="groupList" class="space-y-3"></div>
  </div>

  <!-- CREATE GROUP MODAL -->
  <div id="createGroupModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 hidden">
    <div class="bg-dark-200 rounded-xl p-6 w-[400px] border border-dark-300">
      <h2 class="text-lg font-bold text-accent mb-4">Create Group</h2>
      <input type="text" id="newGroupName" placeholder="Group name" class="w-full px-4 py-2.5 bg-dark-100 border border-dark-300 rounded-lg text-sm text-gray-200 outline-none focus:border-accent mb-4">
      <div class="flex justify-end gap-2">
        <button onclick="closeCreateGroup()" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg text-sm font-semibold transition">Cancel</button>
        <button onclick="createGroup()" class="px-4 py-2 bg-accent hover:bg-accent-light text-white rounded-lg text-sm font-bold transition">Create</button>
      </div>
    </div>
  </div>

  <!-- GROUP DETAIL MODAL -->
  <div id="groupDetailModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 hidden">
    <div class="bg-dark-200 rounded-xl p-6 w-[500px] max-h-[80vh] overflow-y-auto border border-dark-300">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-bold text-accent" id="detailGroupName"></h2>
        <button onclick="closeDetail()" class="text-gray-500 hover:text-white text-xl transition">âœ•</button>
      </div>

      <!-- Account list -->
      <div id="detailAccountList" class="space-y-2 mb-4"></div>

      <!-- Add account -->
      <div class="flex gap-2 mb-3">
        <input type="text" id="newAccountName" placeholder="Account name" class="flex-1 px-3 py-2 bg-dark-100 border border-dark-300 rounded-lg text-sm text-gray-200 outline-none focus:border-accent">
        <button onclick="addAccount()" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg text-sm font-semibold transition">+ Add</button>
      </div>

      <!-- Actions -->
      <div class="flex gap-2">
        <button onclick="generateAccounts()" class="flex-1 px-3 py-2 bg-dark-300 hover:bg-dark-100 text-gray-300 rounded-lg text-sm font-semibold transition border border-dark-300">âš¡ Generate 2</button>
        <button onclick="launchCurrentGroup()" class="flex-1 px-3 py-2 bg-accent hover:bg-accent-light text-white rounded-lg text-sm font-bold transition">ðŸš€ Launch</button>
      </div>
    </div>
  </div>

  <script>
    let groups = []
    let currentGroupId = null

    async function loadGroups() {
      groups = await window.api.getGroups()
      renderGroups()
    }

    function renderGroups() {
      const list = document.getElementById('groupList')
      if (groups.length === 0) {
        list.innerHTML = '<div class="text-gray-600 text-center bg-dark-300 rounded-xl p-8 text-sm">No groups yet. Click + Create Group to get started.</div>'
        return
      }
      list.innerHTML = groups.map(g => `
        <div class="bg-dark-300 rounded-xl px-5 py-4 flex items-center justify-between cursor-pointer hover:bg-dark-200 transition" onclick="openDetail('${g.id}')">
          <div>
            <div class="text-base font-bold">${g.name}</div>
            <div class="text-xs text-gray-500 mt-0.5">${g.accounts.length} / 2 accounts</div>
          </div>
          <div class="flex gap-2 items-center">
            <button onclick="event.stopPropagation(); launchGroup('${g.id}')" class="px-4 py-2 bg-accent hover:bg-accent-light text-white rounded-lg text-sm font-bold transition">ðŸš€ Launch</button>
            <button onclick="event.stopPropagation(); deleteGroup('${g.id}')" class="px-2.5 py-2 bg-red-700 hover:bg-red-600 text-white rounded-lg text-xs font-bold transition">âœ•</button>
          </div>
        </div>
      `).join('')
    }

    // === CREATE GROUP MODAL ===
    function showCreateGroup() {
      document.getElementById('createGroupModal').classList.remove('hidden')
      document.getElementById('newGroupName').value = ''
      document.getElementById('newGroupName').focus()
    }

    function closeCreateGroup() {
      document.getElementById('createGroupModal').classList.add('hidden')
    }

    async function createGroup() {
      const name = document.getElementById('newGroupName').value.trim()
      if (!name) return
      await window.api.addGroup(name)
      closeCreateGroup()
      await loadGroups()
    }

    async function deleteGroup(id) {
      if (!confirm('Delete this group and all its accounts?')) return
      await window.api.deleteGroup(id)
      await loadGroups()
    }

    // === GROUP DETAIL MODAL ===
    async function openDetail(groupId) {
      currentGroupId = groupId
      const group = await window.api.getGroup(groupId)
      if (!group) return

      document.getElementById('detailGroupName').textContent = group.name
      document.getElementById('groupDetailModal').classList.remove('hidden')
      renderDetailAccounts(group)
    }

    function closeDetail() {
      document.getElementById('groupDetailModal').classList.add('hidden')
      currentGroupId = null
      loadGroups()
    }

    function renderDetailAccounts(group) {
      const list = document.getElementById('detailAccountList')
      if (group.accounts.length === 0) {
        list.innerHTML = '<div class="text-gray-600 text-center bg-dark-100 rounded-lg p-4 text-xs">No accounts. Add one or generate 2.</div>'
        return
      }
      list.innerHTML = group.accounts.map((a, i) => `
        <div class="bg-dark-100 rounded-lg px-3 py-2 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <span class="text-[10px] text-gray-600 font-bold w-5">${i + 1}.</span>
            <span class="text-sm font-semibold">${a.name}</span>
          </div>
          <button onclick="removeAccount('${a.id}')" class="px-2 py-1 bg-red-700 hover:bg-red-600 text-white rounded text-xs font-semibold transition">âœ•</button>
        </div>
      `).join('')
    }

    async function addAccount() {
      if (!currentGroupId) return
      const input = document.getElementById('newAccountName')
      const name = input.value.trim()
      if (!name) return
      await window.api.addAccount(currentGroupId, name)
      input.value = ''
      input.focus()
      const group = await window.api.getGroup(currentGroupId)
      renderDetailAccounts(group)
    }

    async function removeAccount(accountId) {
      if (!currentGroupId) return
      await window.api.removeAccount(currentGroupId, accountId)
      const group = await window.api.getGroup(currentGroupId)
      renderDetailAccounts(group)
    }

    async function generateAccounts() {
      if (!currentGroupId) return
      await window.api.generateAccounts(currentGroupId)
      const group = await window.api.getGroup(currentGroupId)
      renderDetailAccounts(group)
    }

    async function launchCurrentGroup() {
      if (!currentGroupId) return
      await window.api.launchGroup(currentGroupId)
    }

    async function launchGroup(id) {
      await window.api.launchGroup(id)
    }

    // Enter key support
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        if (!document.getElementById('createGroupModal').classList.contains('hidden')) createGroup()
        else if (!document.getElementById('groupDetailModal').classList.contains('hidden')) addAccount()
      }
      if (e.key === 'Escape') {
        closeCreateGroup()
        closeDetail()
      }
    })

    loadGroups()
  </script>
</body>
</html>
